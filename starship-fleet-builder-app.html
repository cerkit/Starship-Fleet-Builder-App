<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Space Combat – Fleet Builder</title>
<style>
/* --- Styling unchanged from last working version --- */
/* ... keep your #bfv-app styles, grid, buttons, etc. ... */

/* Print layout */
#bfv-app .print-area{ display:none }
@media print{
  body, #bfv-app{ background:#fff !important; color:#000 !important }
  #bfv-app .bfv-wrap, #bfv-app .panel, #bfv-app .grid{ all:unset }
  #bfv-app .stars, #bfv-app header, #bfv-app .grid, #bfv-app footer{ display:none !important }
  #bfv-app .print-area{ display:block !important; padding:12mm }
  #bfv-app .print-title{ font-size:20pt; font-weight:800; margin:0 0 4mm }
  #bfv-app .print-sub{ font-size:12pt; margin:0 0 6mm }
  #bfv-app table{ width:100%; border-collapse:collapse; font-size:11pt }
  #bfv-app th, #bfv-app td{ border:1px solid #000; padding:6px 8px; text-align:left }
  #bfv-app th{ background:#f0f0f0 }
  #bfv-app tfoot td{ font-weight:700; background:#fafafa }
  #bfv-app .print-footer{ margin-top:8mm; font-size:10pt; color:#000; text-align:right }
  @page{ margin:12mm }
}
</style>
</head>
<body>
<div id="bfv-app">
  <!-- header, panels, fleet name input, catalog, drones, mines, etc. remain unchanged -->

  <!-- PRINT AREA -->
  <div class="print-area" aria-hidden="true">
    <div class="print-title">Starship Fleet Builder</div>
    <div class="print-sub" id="print-subtitle"></div>
    <table id="print-table">
      <thead>
        <tr><th>#</th><th>Name</th><th>Qty</th><th>Row Points</th></tr>
      </thead>
      <tbody></tbody>
      <tfoot>
        <tr>
          <td>Total</td><td></td>
          <td id="print-total-count">0</td>
          <td id="print-total-points">0 points</td>
        </tr>
      </tfoot>
    </table>
    <div class="print-footer" id="print-footer"></div>
  </div>
</div>

<script>
(function(){
  const SHIPS = [
    { id:"humanoid-s4a-scout", faction:"Humanoid", code:"S-4A", name:"Scout", points:115 },
    { id:"humanoid-c6a-cruiser", faction:"Humanoid", code:"C-6A", name:"Heavy Cruiser", points:280 },
    { id:"humanoid-d3a-destroyer", faction:"Humanoid", code:"D-3A", name:"Destroyer", points:190 },
    { id:"humanoid-t2a-transport", faction:"Humanoid", code:"T-2A", name:"Transport", points:80 },
    { id:"alien-s3a-scout", faction:"Alien", code:"S-3A", name:"Scout", points:120 },
    { id:"alien-c3a-cruiser", faction:"Alien", code:"C-3A", name:"Heavy Cruiser", points:290 },
    { id:"alien-d2a-destroyer", faction:"Alien", code:"D-2A", name:"Destroyer", points:195 },
    { id:"alien-t1a-transport", faction:"Alien", code:"T-1A", name:"Transport", points:80 }
  ];
  const DRONE_POINTS = { A:5, B:10, C:15 };
  const MINES_PER_PACK = 4, MINE_PACK_POINTS=5;

  const $=(sel,root=document)=>root.querySelector(sel);
  const $$=(sel,root=document)=>Array.from(root.querySelectorAll(sel));
  const state={ faction:'All', name:'', fleet:[] };

  /* --- wireEvents, renderCatalog, renderFleet, addShipById, addDrones, addMinePacksSafe remain unchanged except below fixes --- */

  // CSV Export
  $('#export-csv', app).addEventListener('click', ()=>{
    const rows=[['#','Name','Qty','Row Points']];
    let totalPoints=0, totalQty=0;
    state.fleet.forEach((it,idx)=>{
      const qty=it.qty||1, rowPts=qty*(it.pointsEach||0);
      totalPoints+=rowPts; totalQty+=qty;
      rows.push([`Ship ${idx+1}`, it.label, qty, `${rowPts} points`]);
    });
    rows.push(['Total','',totalQty,`${totalPoints} points`]);
    const csv=rows.map(r=>r.join(',')).join('\r\n');
    const blob=new Blob([csv],{type:'text/csv;charset=utf-8'});
    const a=document.createElement('a');
    a.href=URL.createObjectURL(blob);
    a.download='fleet.csv'; a.click();
  });

  function buildPrintView(){
    $('#print-subtitle').textContent=state.name||'';
    const tbody=$('#print-table tbody'); tbody.innerHTML='';
    let totalPoints=0, totalQty=0;
    state.fleet.forEach((item,idx)=>{
      const qty=item.qty||1, rowPts=qty*(item.pointsEach||0);
      totalPoints+=rowPts; totalQty+=qty;
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>Ship ${idx+1}</td><td>${item.label}</td><td>${qty}</td><td>${rowPts} points</td>`;
      tbody.appendChild(tr);
    });
    $('#print-total-count').textContent=totalQty;
    $('#print-total-points').textContent=`${totalPoints} points`;
    $('#print-footer').textContent=`Printed on ${new Date().toLocaleString()} — cerkit.com`;
  }
})();
</script>
</body>
</html>

